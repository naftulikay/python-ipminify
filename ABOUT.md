# About

This library aims to serve as a reference implementation for cross-language implementations of the algorithm. I'd like
very much to create implementations for Node, Ruby, Golang, and Rust, but at the moment I do not have the time.

#### Table of Contents

 - [Motivation](#motivation)
 - [Default Alphabet](#default-alphabet)

## Motivation

Why minify IPv4 addresses to strings?

The specific use-case this library was developed for was for automatic DNS management in Route 53 on AWS. When working
with an autoscaling group in EC2, each EC2 instance receives the same `Name` tag and best practices would suggest using
the same value as a hostname.

If, as an example, we have an autoscaling group of Envoy proxies, and each instance's `Name` tag is
`envoy.prod.mycompany.com`, and each instance assumes `envoy.prod.mycompany.com` as a hostname, it becomes difficult
to differentiate instances in the console or in logging/metrics/inventory services. Having eight hosts with the same
name is unideal to say the least.

By default, hostnames are set by [cloud-init](https://cloud-init.io) to values like: `ip-10-0-0-1.somezone`. This is
also unideal:

 1. The hostname does not match the `Name` tag.
 2. The hostname tells us nothing about _what_ the instance actually _is_.

Therefore, I built a system by which instance host names _and_ Route 53 DNS names could arrive at consensus for each
host by templating the `Name` tag and hostname. Route 53 was managed by a Lambda function which listened to EC2 create
and destroy events, and hostnames were managed with software using the same algorithm to achieve hostname/DNS
consensus.

The local hostname service used systemd to execute at a specific point during boot after cloud-init set the default
`ip-10-0-0-1` hostname and before other system services started.

EC2 instances, when tagged with `autodns:enabled` set to `true`, and when containing a template string in the `Name`
tag, such as `envoy-TEMPLATE.prod.mycompany.com`, the local hostname service and the Lambda managing Route 53 would
converge on a unique hostname such as `envoy-f5xw4g.prod.mycompany.com` (`f5xw4g` being the minified address
`10.0.0.1`).

Instances managed by this system would appear in the AWS console with their actual routable DNS name as their `Name`
tag and local services on the machines would see the unique and routable hostname unique to the instance: syslog
and monitoring agents would see the unique name `envoy-f5xw4g.prod.mycompany.com` instead of a generic name or
the autogenerated one.

This management system also did advanced things with SRV records, but IPv4 minification was the core part of the main
functionality detailed above. Providing a reference implementation here should make porting this algorithm to other
languages straightforward and testable.

## Default Alphabet

The default alphabet consists of the following characters:

```
abcdefghjkmnpqrstuvwxyz23456789
```

Specifically, this alphabet consists of lowercase ASCII characters and ASCII digits with lookalike characters removed.
The goal is to eliminate user error, mistaking, say, a `1` (one) for an `l` (lowercase L) or an `I` (capital i).

The common ASCII lookalike characters excluded from the default alphabet are:

 - `i` :point_right: "Lowercase I"
 - `I` :point_right: "Uppercase I"
 - `l` :point_right: "Lowercase L"
 - `1` :point_right: "One"
 - `o` :point_right: "Lowercase O"
 - `O` :point_right: "Uppercase O"
 - `0` :point_right: "Zero"

The only special-case character that is excluded is lowercase O (`o`). This character was excluded for the strange
edge-case of storing or viewing a minified string in uppercase: uppercase "O" and zero often look very similar. Thus,
we have excluded lowercase "O" from the alphabet.
